{% extends "base.html" %}
{% block title %}Contact Seller{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-10 bg-white p-8 rounded-xl shadow-lg">
  <h2 class="text-3xl font-bold mb-6 text-center text-gray-800">Contact {{ seller['name'] }}</h2>

  <!-- Seller Info -->
  <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-6">
    <img src="{{ seller['photo'] or url_for('static', filename='uploads/default_user.jpg') }}"
      alt="{{ seller['name'] }}" class="w-24 h-24 rounded-full object-cover border">
    <div class="text-center sm:text-left">
      <p class="font-semibold text-lg">{{ seller['name'] }}</p>
      <p class="text-gray-600 text-sm">{{ seller['contact_info'] or 'Contact details not available' }}</p>
    </div>
  </div>

  <!-- Contact Methods -->
  <div class="flex flex-wrap justify-center gap-4 mb-8">
    {% if seller['phone'] %}
    <a href="tel:{{ seller['phone'] }}"
      class="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow transition">
      <i class="bi bi-telephone-fill"></i> Call
    </a>
    {% endif %}

    {% if seller['email'] %}
    <a href="mailto:{{ seller['email'] }}"
      class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow transition">
      <i class="bi bi-envelope-fill"></i> Email
    </a>
    {% endif %}

    {% if seller['phone'] %}
    <a href="https://wa.me/{{ seller['phone'] | replace(' ', '') | replace('+', '') }}"
      target="_blank"
      class="flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg shadow transition">
      <i class="bi bi-whatsapp"></i> WhatsApp
    </a>
    {% endif %}
  </div>

  <!-- Message Form -->
  <form method="POST" class="space-y-4">
    <div>
      <label class="block mb-1 font-medium">Your Name</label>
      <input type="text" name="name" required class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400">
    </div>

    <div>
      <label class="block mb-1 font-medium">Your Email</label>
      <input type="email" name="email" required class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400">
    </div>

    <div>
      <label class="block mb-1 font-medium">Message</label>
      <textarea name="message" rows="4" required
        class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400"></textarea>
    </div>

    <button type="submit"
        onclick="sendToWhatsApp(event, '{{ seller['phone'] }}')"
        class="w-full bg-blue-700 hover:bg-blue-800 text-white py-2 rounded-lg font-semibold shadow transition">
    <i class="bi bi-send-fill"></i> Send Message & WhatsApp
    </button>

  </form>
</div>

<style>
  @media (max-width: 640px) {
    .max-w-2xl {
      margin: 1rem;
      padding: 1.5rem;
    }
    h2 {
      font-size: 1.5rem;
    }
  }
</style>

<script>
function sendToWhatsApp(event, phone) {
    event.preventDefault(); // stop normal form submit temporarily

    const name = document.querySelector("input[name='name']").value;
    const email = document.querySelector("input[name='email']").value;
    const message = document.querySelector("textarea[name='message']").value;

    if (!name || !email || !message) {
        alert("Please fill all fields before sending.");
        return;
    }

    const text = `New Inquiry from ${name}%0AEmail: ${email}%0A%0AMessage:%0A${message}`;
    const cleanedPhone = phone.replace(/\s+/g, "").replace(/\+/g, "");

    const url = `https://wa.me/${cleanedPhone}?text=${text}`;

    // Open WhatsApp
    window.open(url, "_blank");

    // Submit the form normally after WhatsApp opens
    setTimeout(() => {
        event.target.closest("form").submit();
    }, 1500);
}
</script>

{% endblock %}
