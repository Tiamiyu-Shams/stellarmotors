{% extends "base.html" %}
{% block title %}Browse Cars{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Search & Filters -->
  <form method="get" class="row g-3 mb-4 align-items-end">
    <div class="col-md-5">
      <label class="form-label small fw-semibold">Search</label>
      <input type="text" name="search" value="{{ search }}" placeholder="Search by name/model..."
        class="form-control shadow-sm">
    </div>

    <div class="col-md-3">
      <label class="form-label small fw-semibold">Category</label>
      <select name="category" class="form-select shadow-sm">
        <option value="">All</option>
        {% for cat in categories %}
        <option value="{{ cat }}" {% if cat == category %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
      <label class="form-label small fw-semibold">Sort By</label>
      <select name="sort_by" class="form-select shadow-sm">
        <option value="date_added" {% if sort_by=='date_added' %}selected{% endif %}>Newest</option>
        <option value="price" {% if sort_by=='price' %}selected{% endif %}>Price ↑</option>
        <option value="price_desc" {% if sort_by=='price_desc' %}selected{% endif %}>Price ↓</option>
      </select>
    </div>

    <div class="col-md-1">
      <button class="btn btn-primary shadow-sm w-100"><i class="bi bi-search"></i></button>
    </div>
  </form>

  <!-- Car Grid -->
  {% if cars %}
  <div class="row g-4">
    {% for car in cars %}
    <div class="col-md-4">
      <div class="card shadow-sm border-0 h-100 hover-shadow">
       <img src="{{ car.main_image if car.main_image else url_for('static', filename='images/default_car.jpg') }}"
     class="card-img-top" style="height:220px; object-fit:cover;">



        <div class="card-body">
          <h5 class="fw-bold">{{ car['title'] }}</h5>
          <p class="text-muted small">{{ car['description']|truncate(80, True) }}</p>
          <p class="fw-bold text-success mb-1">₦{{ "{:,.0f}".format(car['price']) }}</p>

          {% if car['category'] %}
          <span class="badge bg-secondary">{{ car['category'] }}</span>
          {% endif %}
        </div>

        <div class="card-footer bg-white text-center border-0">
          <a href="{{ url_for('main.car_detail', car_id=car['id']) }}"
             class="btn btn-outline-primary rounded-pill px-4">View</a>
        </div>

      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info text-center mt-4">No matching cars found.</div>
  {% endif %}

  <!-- Pagination -->
  {% if total_pages > 1 %}
  <div class="d-flex justify-content-center mt-4 gap-2">
    {% if page > 1 %}
    <a href="{{ url_for('main.cars', page=page-1, search=search, category=category, sort_by=sort_by) }}"
       class="btn btn-light border">← Prev</a>
    {% endif %}

    {% for p in range(1, total_pages+1) %}
    <a href="{{ url_for('main.cars', page=p, search=search, category=category, sort_by=sort_by) }}"
       class="btn {% if p == page %}btn-primary text-white{% else %}btn-outline-secondary{% endif %}">
      {{ p }}
    </a>
    {% endfor %}

    {% if page < total_pages %}
    <a href="{{ url_for('main.cars', page=page+1, search=search, category=category, sort_by=sort_by) }}"
       class="btn btn-light border">Next →</a>
    {% endif %}
  </div>
  {% endif %}

</div>

<style>
.hover-shadow:hover { transform: translateY(-4px); transition:.2s; box-shadow:0 8px 20px rgba(0,0,0,0.1); }
</style>
{% endblock %}

