{% extends "base.html" %}
{% block title %}Home — Stellar Motors{% endblock %}

{% block content %}

<!-- Top Section -->
<section class="bg-white rounded-lg shadow p-6 mb-8">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold text-primary-900">Find your next car</h1>
      <p class="mt-2 text-slate-600">Browse curated new & pre-owned vehicles — Stellar Motors.</p>
    </div>

    <a href="{{ url_for('admin.dashboard') }}"
       class="hidden md:inline-block bg-primary-900 text-white px-4 py-2 rounded">
      Admin Panel
    </a>
  </div>
</section>



<!-- FILTERS SECTION -->
<section class="mb-6">
  <!-- FILTER BUTTON (Mobile only) -->
  <button id="filterToggleBtn"
    class="md:hidden w-full bg-blue-600 text-white py-2 rounded-lg shadow font-medium mb-3">
    Filters ▾
  </button>

  <!-- FILTER PANEL -->
  <form id="filterPanel"
        method="GET"
        class="bg-white rounded-lg shadow p-4 grid md:grid-cols-4 gap-4 hidden md:grid">

    <!-- Search -->
    <div>
      <label class="block text-sm font-medium text-slate-700 mb-1">Search</label>
      <input type="text" name="search" placeholder="Car name..."
             value="{{ request.args.get('search','') }}"
             class="w-full border rounded p-2" />
    </div>

    <!-- Category -->
    <div>
      <label class="block text-sm font-medium text-slate-700 mb-1">Category</label>
      <select name="category" class="w-full border rounded p-2">
        <option value="">All</option>
        {% for cat in categories %}
          <option value="{{ cat['category'] }}"
            {% if request.args.get('category') == cat['category'] %}selected{% endif %}>
            {{ cat['category'] }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Price Range -->
    <div>
      <label class="block text-sm font-medium text-slate-700 mb-1">Price (₦)</label>
      <div class="flex gap-2">
        <input type="number" name="min_price" placeholder="Min"
               value="{{ request.args.get('min_price','') }}"
               class="w-1/2 border rounded p-2" />
        <input type="number" name="max_price" placeholder="Max"
               value="{{ request.args.get('max_price','') }}"
               class="w-1/2 border rounded p-2" />
      </div>
    </div>

    <!-- Sort -->
    <div>
      <label class="block text-sm font-medium text-slate-700 mb-1">Sort By</label>
      <select name="sort" class="w-full border rounded p-2">
        <option value="">Newest</option>
        <option value="price_asc"
          {% if request.args.get('sort') == 'price_asc' %}selected{% endif %}>
          Price: Low → High
        </option>
        <option value="price_desc"
          {% if request.args.get('sort') == 'price_desc' %}selected{% endif %}>
          Price: High → Low
        </option>
      </select>
    </div>

    <!-- Desktop Buttons Row -->
    <div class="hidden md:flex md:col-span-4 justify-between mt-2">
      <button class="bg-blue-600 text-white px-4 py-2 rounded shadow">
        Apply Filters
      </button>

      <!-- Clear Filters Button -->
      <a href="{{ url_for('main.index') }}"
         class="bg-gray-300 text-gray-800 px-4 py-2 rounded shadow hover:bg-gray-400">
        Clear Filters
      </a>
    </div>

  </form>

  <!-- Mobile Buttons -->
  <div class="md:hidden flex gap-3 mt-3">
    <!-- Apply Filters -->
    <button type="submit" form="filterPanel"
            class="w-1/2 bg-blue-600 text-white py-2 rounded-lg">
      Apply
    </button>

    <!-- Clear Filters -->
    <a href="{{ url_for('main.index') }}"
       class="w-1/2 bg-gray-300 text-gray-800 py-2 rounded-lg text-center">
      Clear
    </a>
  </div>
</section>



<!-- CARS LIST -->
<section id="cars" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

  {% if cars|length == 0 %}
    <div class="col-span-full text-center py-10 text-slate-500 text-lg">
      No cars found. Try adjusting your filters.
    </div>
  {% endif %}

  {% for car in cars %}
  <div class="bg-white rounded-xl shadow overflow-hidden hover:shadow-lg transition">
    <img src="{{ car.main_image }}" 
         alt="{{ car['title'] }}"
         class="w-full h-72 object-cover"> 

    <div class="p-4">
      <div class="flex justify-between items-start">
        <h3 class="text-lg font-semibold">{{ car['title'] }}</h3>
        <div class="text-primary-900 font-bold">₦{{ "{:,.0f}".format(car['price']) }}</div>
      </div>

      <p class="mt-2 text-sm text-slate-600">{{ car['description'] }}</p>

      <div class="mt-4 flex items-center gap-3">
        <img src="{{ car['seller_photo'] }}"
             alt="{{ car['seller_name'] }}"
             class="w-10 h-10 rounded-full object-contain border"/>
             

        <div class="text-sm text-slate-700">
          {{ car['seller_name'] }}
        </div>
      </div>

      <a href="{{ url_for('main.car_detail', car_id=car['id']) }}"
        class="inline-block mt-3 bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700">
        View Details
      </a>
    </div>
  </div>
  {% endfor %}
</section>



<!-- Load More Button -->
{% if show_load_more %}
<div class="text-center my-10">
  <a href="?page={{ next_page }}&{{ query_string }}"
     class="bg-gray-700 text-white px-6 py-2 rounded shadow hover:bg-gray-900">
    Load More
  </a>
</div>
{% endif %}


<!-- Javascript -->
<script>
  const btn = document.getElementById("filterToggleBtn");
  const panel = document.getElementById("filterPanel");

  btn.addEventListener("click", () => {
    panel.classList.toggle("hidden");
  });
</script>



{% endblock %}

